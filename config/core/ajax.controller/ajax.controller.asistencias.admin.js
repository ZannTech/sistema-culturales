function logout(){$.ajax({url:"../../config/core/controller/controller.asistencias.data.php?asistencias=logout",success:function(e){}})}function getEncargados(){$.ajax({url:"../../config/core/controller/controller.asistencias.data.php?asistencias=rq-fetch-manager",method:"POST",beforeSend:()=>{},success:e=>{let a='<option value="">Seleccione a un encargado</option>';JSON.parse(e).forEach(e=>{a+=`\n                    <option value="${e.ID}">${e.NO_C} - ${e.GradoGrupo} - ${e.Taller} - ${e.Nombre}</option>\n                    `}),$("#encargado").html(a)},error:()=>{}})}function insertAsistencia(e,a,r){}function padNmb(e,a){var r=String(e);return"0000000000".substr(0,a-r.length)+r}function stringToSeconds(e){var a=e.indexOf(":"),r=e.lastIndexOf(":"),s=e.substr(0,a),t=e.substr(a+1,r-a-1),o=e.substr(r+1);return Number(o)+60*Number(t)+3600*Number(s)}function secondsToTime(e){var a=Math.floor(e/3600),r=Math.floor((e-3600*a)/60),s=e-3600*a-60*r;return padNmb(a,2)+":"+padNmb(r,2)+":"+padNmb(s,2)}function substractTimes(e,a){return secondsToTime(stringToSeconds(e)-stringToSeconds(a))}$(document).ready(()=>{getEncargados(),$("#sep").html("<br><br><br>"),$("#encargado").on("change",()=>{$("#i-fecha-salida").attr("disabled",!1),$("#i-fecha-entrada").attr("disabled",!1),$("#state").attr("disabled",!1),$("#btn_asistencia").attr("disabled",!1),""==$("#encargado option:selected").val()&&($("#i-fecha-salida").attr("disabled",!0),$("#i-fecha-entrada").attr("disabled",!0),$("#state").attr("disabled",!0),$("#btn_asistencia").attr("disabled",!0))}),$("#insert-as").on("submit",e=>{e.preventDefault();let a=$("#encargado option:selected").val(),r=$("#i-fecha-entrada").val(),s=$("#i-fecha-salida").val(),t=$("#state").val();""!=a&&""!=r&&""!=s&&""!=t?$.ajax({url:"../../config/core/controller/controller.asistencias.data.php?exist-asistencia-docente",data:"id="+a,method:"POST",cache:!1,success(e){if(1!=e){let e=substractTimes(s+":00",r+":00");if(s>r)if(e<="04:00:00"){let e=substractTimes(s+":00",r+":00"),t=$("#insert-as").serialize();$.ajax({url:"../../config/core/controller/controller.asistencias.data.php?insert-asistencia-docente",method:"POST",data:t+"&hrs="+e+"&id="+a,cache:!1,success:e=>{$("#loader").hide(),1==e&&Swal.fire("Asistencia registrada","Se ha registrado la asistencia,<b><br>Gracias por contribuir :)</b>","success")},beforeSend:e=>{$("#loader").show()},error:e=>{}})}else Swal.fire("No se puede asistir más de 4 hrs a la semana");else Swal.fire("Hora de salida no válida, introduce una hora válida")}else 1==e?Swal.fire("Ya se há registrado una asistencia a este alumno"):Swal.fire("Error en los servidores, carga la página de nuevo")}}):Swal.fire("Por favor rellene todos los campos requeridos","","error")}),$("#btn-log").on("click",()=>{logout(),Swal.fire("Sesión cerrada","Saliendo del sistema","success").then(()=>{location.reload()})})});