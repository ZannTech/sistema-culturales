function getAlumno(){let a=$("#taller").val();$.ajax({url:"../../config/core/controller/controller.asistencias.data.php?asistencias=rq-fetch-alumno",method:"POST",data:a,cache:!1,success:a=>{console.log(a),a=JSON.parse(a);let e='<option value="">Seleccione a un alumno</option>';a.forEach(a=>{e+=`\n          <option value="${a.ID}">${a.NO_C} - ${a.GradoGrupo} - ${a.Taller} - ${a.Nombre}</option>\n          `}),$("#alumno").html(e)},beforeSend:()=>{},error:a=>{}})}function padNmb(a,e){var s=String(a);return"0000000000".substr(0,e-s.length)+s}function logout(){$.ajax({url:"../../config/core/controller/controller.asistencias.data.php?asistencias=logout",success:function(a){console.log(a)}})}function stringToSeconds(a){var e=a.indexOf(":"),s=a.lastIndexOf(":"),t=a.substr(0,e),r=a.substr(e+1,s-e-1),i=a.substr(s+1);return Number(i)+60*Number(r)+3600*Number(t)}function secondsToTime(a){var e=Math.floor(a/3600),s=Math.floor((a-3600*e)/60),t=a-3600*e-60*s;return padNmb(e,2)+":"+padNmb(s,2)+":"+padNmb(t,2)}function substractTimes(a,e){return secondsToTime(stringToSeconds(a)-stringToSeconds(e))}$(document).ready(()=>{getAlumno(),$("#btn-log").on("click",()=>{logout(),Swal.fire("Sesión cerrada","Saliendo del sistema","success").then(()=>{location.reload()})}),$("#sep").html("<br><br><br>"),$("#alumno").on("change",()=>{$("#i-fecha-salida").attr("disabled",!1),$("#i-fecha-entrada").attr("disabled",!1),$("#state").attr("disabled",!1),$("#btn_asistencia").attr("disabled",!1),""==$("#alumno option:selected").val()&&($("#i-fecha-salida").attr("disabled",!0),$("#i-fecha-entrada").attr("disabled",!0),$("#state").attr("disabled",!0),$("#btn_asistencia").attr("disabled",!0))}),$("#insert-as").on("submit",a=>{a.preventDefault();let e={id:$("#alumno option:selected").val(),entrada:$("#i-fecha-entrada").val(),salida:$("#i-fecha-salida").val(),Estado:$("#state").val()};""!=e.id?""!=e.entrada?""!=e.salida?""!=e.Estado?$.ajax({url:"../../config/core/controller/controller.asistencias.data.php?exist-asistencia="+e.id,cache:!1,success:a=>{if(1!=a){let a=substractTimes(e.salida+":00",e.entrada+":00");if(e.salida>e.entrada)if(a<="04:00:00"){let s=$("#insert-as").serialize(),t=e.id;$.ajax({url:"../../config/core/controller/controller.asistencias.data.php?insert-asistencia="+e.id,method:"POST",data:s+"&hrs="+a+"&id="+t,cache:!1,success:a=>{$("#loader").hide(),1==a&&Swal.fire("Asistencia registrada","Se ha registrado la asistencia,<b><br>Gracias por contribuir :)</b>","success")},beforeSend:a=>{$("#loader").show()},error:a=>{}})}else Swal.fire("No se puede asistir más de 4 hrs a la semana");else Swal.fire("Hora de salida no válida, introduce una hora válida")}else 1==a?Swal.fire("Ya se há registrado una asistencia a este alumno"):Swal.fire("Error en los servidores, carga la página de nuevo")}}):Swal.fire("Indica el estado de la asistencia"):Swal.fire("Indica la hora de salida"):Swal.fire("Indica la hora de entrada"):Swal.fire("No has seleccionado a ningun alumno")})});