$(document).ready(()=>{fetchRequest(),$("#btn-update").on("click",()=>{window.location.reload()}),$(".sp").html("<br><bt>"),$(".delete").on("click",()=>{deny($("#h-cer").attr("href"),$(".delete").attr("id"))}),$(".view").on("click",()=>{accept($(".view").attr("id"))})});var fetchRequest=function(){$.ajax({url:"../../config/core/controller/controller.global.page.php?fetch-data=pre",method:"POST",success:e=>{$("#loader").hide();var o=JSON.parse(e),a=$("#pre-reg").DataTable({destroy:!0,data:o,columns:[{data:"Nombre"},{data:"Taller"},{data:"GradoGrupo"},{data:"NoControl"},{defaultContent:"<button class='ver btn btn-primary' >Ver detalles</button>"}],columnDefs:[{targets:["_all"],className:"mdc-data-table__cell"}],language:{sProcessing:"Cargando... por favor espere",sLengthMenu:"Ver    _MENU_   alumnos",sZeroRecords:"No se ha encontrado ningún alumno",sEmptyTable:"No se hán registrado alumnos aún :(",sInfo:"_START_ - _END_  de _TOTAL_ ",sInfoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",sInfoFiltered:"",sInfoPostFix:"",sSearch:"Buscar:",sUrl:"",sInfoThousands:",",sLoadingRecords:"Cargando...",oPaginate:{sFirst:"Primero",sLast:"Último",sNext:">",sPrevious:"<"},oAria:{sSortAscending:": Activar para ordenar la columna de manera ascendente",sSortDescending:": Activar para ordenar la columna de manera descendente"},buttons:{copy:"Copiar",colvis:"Visibilidad"}}});obtener_data("#pre-reg tbody",a)},beforeSend:()=>{$("#loader").show()}})},obtener_data=function(e,o){var a;$(e).on("click","button.ver",function(){a=o.row($(this).parents("tr")).data(),$("#bs-data").modal("show");$("#tx-noc").html("Número de control: <b>"+a.NoControl+"</b>"),$("#tx-nombre").html("Nombre: <b> "+a.Nombre+"</b>"),$("#tx-taller").html("Taller: <b> "+a.Taller+"</b>"),$("#tx-gr").html("Grupo: <b> "+a.GradoGrupo+"</b>"),$("#tx-num").html("Numero de teléfono: <b> "+a.Telefono+"</b>"),$("#tx-curp").html("Curp: <b> "+a.Curp+"</b>"),$("#tx-gen").html("Género: <b> "+a.Genero+"</b>"),$("#tx-fecha").html("Fecha de nacimiento: <b> "+a.FechaNacimiento+"</b>"),$("#tx-email").html("Email: <b> "+a.Email+"</b>");var e="../../"+a.RutaCertificado,r="../../"+a.CartaCompromiso;$("#h-cer").attr("href",e),$("#h-car").attr("href",r),$("#img-student").attr("src","../../"+a.RutaFoto),a.Nombre,a.id;$(".view").attr("id",a.id),$(".delete").attr("id",a.id)})};function accept(e){Swal.fire({title:"¿Seguro que quieres aceptar a el alumno seleccionado? <b>",showCancelButton:!0,confirmButtonText:"Aceptar",cancelButtonText:"Cancelar",allowEscapeKey:!1,allowOutsideClick:!1,icon:"question"}).then(o=>{o.isConfirmed&&$.ajax({url:"../../config/core/controller/controller.global.page.php?cls-crud-pre=fetch-pre-by-id",data:"id="+e,method:"POST",cache:!1,success:o=>{let a;JSON.parse(o).forEach(e=>{a={NoControl:e.NoControl,"Contraseña":e.Curp,Nombre:e.Nombre,Curp:e.Curp,GradoGrupo:e.GradoGrupo,Taller:e.Taller,Genero:e.Genero,FechaNacimiento:e.FechaNacimiento,Domicilio:e.Domicilio,Telefono:e.Telefono,Email:e.Email}}),$.ajax({url:"../../config/core/controller/controller.global.page.php?cls-crud-pre=accept",data:"NoControl="+a.NoControl+"&Contraseña="+a.Contraseña+"&Nombre="+a.Nombre+"&Curp="+a.Curp+"&GradoGrupo="+a.GradoGrupo+"&Taller="+a.Taller+"&Genero="+a.Genero+"&Fecha="+a.FechaNacimiento+"&Domicilio="+a.Domicilio+"&Telefono="+a.Telefono+"&Email="+a.Email+"&id="+e,method:"POST",cache:!1,success:e=>{console.log(e),$("#loader").hide(),11==e?Swal.fire("Alumno aceptado","Se ha aceptado al alumno","success"):"r"==e?Swal.fire("Ya se ha registrado este alumno","Se eliminará la solicitud","warning"):Swal.fire("Hubo un error","Contacta a soporte","error"),fetchRequest(),$("#bs-data").modal("hide")}})},beforeSend:()=>{$("#loader").show()}})})}function deny(e,o){Swal.fire({title:"Se eliminará la solicitud y no se aceptará en el programa ¿Continuar? <b>",showCancelButton:!0,confirmButtonText:"Aceptar",cancelButtonText:"Cancelar",allowEscapeKey:!1,allowOutsideClick:!1,icon:"warning"}).then(a=>{a.isConfirmed&&$.ajax({url:"../../config/core/controller/controller.global.page.php?cls-crud-pre=delete",data:"id="+o+"&route="+e,method:"POST",cache:!1,success:e=>{if(console.log(e),1==e){Swal.fire("Se ha denegado la solicitud","Se ha eliminado la solicitud de este alumno","success").then(()=>{fetchRequest(),$("#bs-data").modal("hide")})}else Swal.fire("Error en los servidores, por favor contacte soporte","","error")}})})}